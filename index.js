//////////////////////////////////////////////////////////////
// Consts
//////////////////////////////////////////////////////////////
var httpPort = 8080

//////////////////////////////////////////////////////////////
// Dependencies
//////////////////////////////////////////////////////////////
var express = require('express')
var logger = require('./logger').logger
var dal = require('./mongodb')
var bodyParser = require('body-parser')
var DataLoader = require('./dataloader')
var routes = require('./routes')

//////////////////////////////////////////////////////////////
// Server configuration
//////////////////////////////////////////////////////////////
var app = express()
app.use(bodyParser.json())

//////////////////////////////////////////////////////////////
// Routes
//////////////////////////////////////////////////////////////
app.get('/', function(req,res,callback) {
	res.end('hi')
})

app.get('/countrycount', routes.getCountByCountry)

//////////////////////////////////////////////////////////////
// Initialize
//////////////////////////////////////////////////////////////

dal.connect(function(err) {
	if (!err) {
		var server = app.listen(httpPort, function() {
			logger.info('Service started using port ' + server.address().port + '.')

			DataLoader.Load();
		})
	}
});